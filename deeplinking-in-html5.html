<!DOCTYPE html><html lang="en"><head>
    <meta name="author" content="Julien Barbay">
    <meta name="twitter:creator" content="@y_nk">
    <meta name="twitter:card" content="summary">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>y_nk – Deeplinking with HTML5</title>

    <link rel="stylesheet" type="text/css" href="./style.css">
    <link rel="icon" type="image/svg+xml" href="./favicon.svg">
    <link rel="alternate" type="application/rss+xml" href="./feed.xml">

    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.0.0/build/styles/paraiso-dark.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.0.0/build/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  <meta property="og:type" content="article"><meta property="article:author" content="Julien Barbay"><meta property="og:title" content="Deeplinking with HTML5"><meta property="description" content="What is deeplinking? How does it work?"><meta property="og:description" content="What is deeplinking? How does it work?"><meta property="og:url" content="/deeplinking-in-html5.html"><meta property="article:published_time" content="1318291200000"></head>

  <body class="post">
    <header>
      <h1><a href="./">
        <svg id="y_nk" viewBox="0 0 100 65">
          <polygon class="bk" points="10.1,0 20.3,10.1 0,10.1"></polygon>
          <polygon class="ft" points="20.3,10.1 46.2,36.1 36.1,46.2 0,10.1"></polygon>
          <polygon class="bk" points="35.6,10.1 45.8,20.3 45.8,0"></polygon>
          <polygon class="ft" points="89.9,44.3 89.9,64.6 45.8,20.3 45.8,0"></polygon>
          <polygon class="bk" points="89.9,0 79.7,10.1 100,10.1"></polygon>
          <polygon class="ft" points="79.7,10.1 75.3,14.6 85.4,24.7 100,10.1"></polygon>
          <polygon class="bk" points="100,54.4 89.9,44.3 89.9,64.6"></polygon>
        </svg>
      </a></h1>
    </header>

    <section id="main">
  <hgroup>
    <h2>Deeplinking with HTML5</h2>
    <h6>October 11th, 2011</h6>
  </hgroup>
 <article>
    <p><disclaimer>The original article has been retrieved from the internet archive machine and edited for fluidity.</disclaimer></p>
<p>Since I had different needs that the one given with swfaddress, I decided to write my own. Plus being a real challenge to learn while rewriting such a famous library, it’s a good opportunity to add the html5 <code>window.history.pushState</code> feature and get clean non hashed urls.</p>
<p>The current <a href="http://www.asual.com/swfaddress/">SWFAddress</a> version listens to <code>onhashchange</code> events and operates fully on <code>window.location.hash</code>. For older browsers, there's a fallback strategy with a timer which checks at low intervals the current browser values against some cached values. If different, the url has changed and a function is called. That’s it.</p>
<p>Recently was introduced the HTML History API, with its <code>pushState</code> methods which has the ability to rewrite the current url without having to use a hash. So, prettier urls and better indexation.</p>
<p>Using <code>pushState</code> changes the way we check for current url. We must now use <code>window.location.href</code> which holds an absolute url value, rather than <code>window.location.hash</code> which stores a relative value. You somehow need to strip out the <em>base url</em> off the values to operate seemlessly between the two methods.</p>
<p>Solving that is easy. There are plenty of solutions but the one I liked the most is to add an HTML <code>&lt;base&gt;</code> tag in your document's <code>&lt;head&gt;</code>, which describes the base url of your site. </p>
<p>As for now a big amount of (dummy) users are still using older browsers, so i also implemented the regular hash engine with events and timers, and choose what method to use with <code>window.history.pushState != undefined</code> test. I really thought that compatibility wouldn’t be a problem but since internet explorer doesn’t store hash values in its history I had to come with a hack implying an iframe, thanks to <a href="https://stackoverflow.com/a/1647331/335243">stackoverflow</a>.</p>
<p>So, it’s working both ways: with and without hash :)</p>
<p>I first wrote it as a jQuery plugin because it was easier for me. Even if I mainly do flash websites, I still load jQuery for handy bootstraping features. A while after, i adapted the script to have a pure javascript object. It’s less automatic but there’s no dependencies :)</p>
<p>In short, it can be embedded in <code>jQuery.deeplinking</code> or used without dependencies as a global <code>Deeplinking</code> javascript object.</p>
<p>The plugin is also able to hook on the top of swfobject directly (both jQuery and standalone). It will try to fire a single function called ‘deeplinking’ with the event type as first argument. Because jQuery’s swfobject plugin had a different behavior — including the object element in the selector instead of replacing it — i had to fork it and do some magic there :/ Bare with me friends.</p>
<p>The good news is that, you can even use it with flash content &lt;3</p>
<p>Btw, if you’re using that jQuery plugin for a flash projet, you may be interested in fixing an <a href="https://stackoverflow.com/a/2837120/335243">annoying resizing bug</a> generated by jQuery itself.</p>
<h3 id="documentation">Documentation</h3>
<p>You can access the static deeplinking object by using <code>deeplinking</code> for the standalone version, and <code>$.deeplinking</code> for the jQuery version. After that it's all the same. </p>
<p>Functions worth mentioning:</p>
<p><strong>deeplinking.onready</strong>: Set a function and it will be called when the deeplinking object is ready and running.</p>
<p><strong>deeplinking.oninternalchange</strong>: Set a function and it'll be called when there's an <em>internal</em> url update (basically, when you set the deeplinking value by the code).</p>
<p><strong>deeplinking.onexternalchange</strong>: Set a function and it'll be called when there's an <em>external</em> url update. It’s the most useful: it’ll be fired when the user changes the url, or press back/forward buttons.</p>
<p><strong>deeplinking.value()</strong>: It’s a getter/setter function (depending if there's an argument or not). It will either return the current url, or set the url with the provided value and fire the <code>oninternalchange</code> callback.</p>
<p><strong>deeplinking.initialize()</strong>: You need to call this method, hopefully on dom ready. When used with flash, I found that I was easier to let Flash call this method with an <code>ExternalInterface.call()</code>. With jQuery, it’s automatically fired on domready, so chill out.</p>
<p><strong>deeplinking.activate()</strong>: Enables the url watcher</p>
<p><strong>deeplinking.deactivate()</strong>: Disables the url watcher</p>
<p><strong>deeplinking.log</strong>: a log function, for debugging purpose. logging is deactivated by default, but you can turn it on with <code>debug</code></p>
<p><strong>deeplinking.debug</strong>: flip this boolean to true to activate logging</p>
<p><strong>deeplinking.html5</strong>: flip this boolean to force the use of <code>pushState</code>, but also force the use of hash (if false)</p>
<h4 id="compatibility">Compatibility</h4>
<p>It's been manually tested on:</p>
<p>Mozilla Firefox 6 and 7, Chrome 14, Internet Explorer 6/7/8 and Safari 4 for Windows for the PC part, and Mozilla Firefox 7, Chrome 14, Safari 4 for the MacOS part.</p>
<p><a href="https://github.com/y-nk/bond">Fourchette it on github :)</a></p>

  </article></section>

    <footer>
      <a href="./" class="!">← back</a>
    </footer>

    <script>
      const colors = ['blue', 'cornflowerblue', 'darkorange', 'darkturquoise', 'deepskyblue', 'dodgerblue',
        'gold', 'goldenrod', 'indigo', 'lightcoral', 'lightgreen', 'lightpink', 'lightseagreen', 'lightskyblue',
        'lightslategray', 'limegreen', 'mediumaquamarine', 'mediumblue', 'mediumspringgreen', 'midnightblue',
        'moccasin', 'navajowhite', 'orange', 'orangered', 'palegreen', 'paleturquoise', 'pink', 'rebeccapurple',
        'royalblue', 'salmon', 'sandybrown', 'seagreen', 'skyblue', 'springgreen', 'steelblue', 'teal', 'tomato']

      document.body.style.setProperty('--accent', colors[Math.floor(Math.random() * colors.length)])
    </script>
  

</body></html>